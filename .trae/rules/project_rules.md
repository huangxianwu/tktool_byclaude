# TK Tool 项目开发规则

## 1. 结构化分析方法

### 触发提示语
当用户使用以下精简提示语时，AI必须按照结构化分析方法执行：

**主要触发词：`#分析`**

#### 使用方式示例：
- `#分析 我需要在系统中添加音频上传功能`
- `#分析 如何优化数据库查询性能`
- `#分析 实现用户权限管理系统`

#### 其他触发方式：
- `请进行结构化分析：[具体需求]`
- `按照标准方法分析：[具体需求]`

### 执行规则

#### 触发后的强制回复结构
当检测到触发提示语时，必须严格按照以下5个章节顺序回复：

1. **需求复述** - 准确理解并重新表述用户的核心需求
2. **问题分析** - 识别技术难点、系统限制和可行性评估
3. **实现方案** - 提供高层次的解决方案架构
4. **实现思路** - 详细描述各模块的实现策略
5. **实现逻辑** - 使用流程图式描述业务流程

#### 格式要求
- 使用Markdown格式和编号列表
- 流程描述使用箭头符号 `→` 连接
- 代码相关内容用反引号包围但不提供完整代码
- 保持内容精炼但信息完整

#### 重要约束
- **仅在明确检测到触发提示语时执行此规则**
- **严禁在结构化分析中直接提供代码实现**
- 不得跳过任何必需的章节

## 2. AI辅助开发与文档同步规则

### 核心原则
- **一致性保证**：代码变更必须与PRD、README、CHANGELOG保持同步
- **人工确认**：所有文档更新必须经过人工审核确认
- **可追溯性**：每次变更都要有清晰的记录和版本管理
- **渐进式**：支持分阶段实施和回滚机制

### 开发工作流

#### 阶段1：任务创建与AI执行
```
用户创建开发任务 → AI分析需求 → AI实施代码变更 → 生成变更报告
```

**AI职责：**
- 理解用户需求并进行结构化分析
- 实施代码变更（新功能、修复、重构）
- 生成详细的变更报告，包括：
  - 修改的文件列表
  - 新增的功能点
  - 修复的问题
  - 对现有功能的影响

#### 阶段2：人工审核与确认
```
AI提交变更报告 → 人工代码审核 → 功能测试 → 确认或拒绝
```

**人工职责：**
- 审核代码质量和逻辑正确性
- 测试新功能和回归测试
- 确认变更符合项目需求
- 决定是否进入文档同步阶段

#### 阶段3：文档同步（仅在人工确认后执行）
```
人工确认通过 → 执行文档同步脚本 → 更新PRD/README/CHANGELOG → 提交变更
```

**自动化操作：**
```bash
# 同步文档（基于Git提交记录）
python scripts/sync_docs.py --since [last_sync_date]

# 检查一致性
python scripts/check_consistency.py

# 生成变更报告
python scripts/generate_report.py
```

### 拒绝处理机制

#### 当人工审核拒绝时：
1. **记录拒绝原因**：详细说明问题所在
2. **回滚代码变更**：恢复到变更前状态
3. **重新分析需求**：基于反馈重新设计方案
4. **重新实施**：按照修正后的方案重新开发

#### 回滚命令：
```bash
# 回滚到指定提交
git reset --hard [commit_hash]

# 清理未跟踪文件
git clean -fd

# 重新同步文档
python scripts/sync_docs.py --rollback [version]
```

### 特殊情况处理

#### 紧急修复流程
对于紧急bug修复，可以简化流程：
```
发现紧急问题 → AI快速修复 → 立即测试 → 快速确认 → 同步文档
```

#### 实验性功能
对于实验性功能开发：
```
创建实验分支 → AI开发 → 充分测试 → 评估效果 → 决定合并或废弃
```

### 一致性检查机制

#### 自动检查项目：
- PRD中的功能点是否在代码中实现
- README中的使用说明是否与实际API一致
- CHANGELOG中的版本记录是否完整
- 代码注释与实际功能是否匹配

#### 检查命令：
```bash
# 全面一致性检查
python scripts/check_consistency.py --full

# 检查特定模块
python scripts/check_consistency.py --module [module_name]

# 生成一致性报告
python scripts/check_consistency.py --report
```

### 建议的自动化命令

#### 日常开发：
```bash
# 开始新功能开发
python scripts/start_feature.py --name [feature_name]

# 完成功能开发并同步文档
python scripts/complete_feature.py --feature [feature_name]

# 检查项目状态
python scripts/project_status.py
```

#### 版本管理：
```bash
# 准备新版本发布
python scripts/prepare_release.py --version [version_number]

# 发布版本
python scripts/release.py --version [version_number]
```

## 3. 日常对话规则
- **未使用触发提示语的对话保持正常交流**
- 简单问题直接回答，无需结构化分析
- 代码调试、修改等技术问题正常处理
- 只有明确使用 `#分析` 等触发词才执行结构化分析

## 4. 使用建议
- 复杂功能开发前使用 `#分析` 进行系统性分析
- 架构设计讨论时使用结构化方法
- 技术方案选型时进行全面分析
- 重要功能变更必须经过完整的审核流程
- 定期执行一致性检查确保项目质量